///////////////////////////////////////////////////////////////////////////////
// ADDINS
///////////////////////////////////////////////////////////////////////////////
#addin "Cake.FileHelpers"

///////////////////////////////////////////////////////////////////////////////
// TOOLS
///////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////
// ARGUMENTS
// Example command:
// .\build.ps1 --productVersion="1.0"
//////////////////////////////////////////////////////////////////////

var target = Argument("target", "Default");
var configuration = Argument("configuration", "Release");
var version = Argument("productVersion", "9.9.9.9");

//////////////////////////////////////////////////////////////////////
// TASKS
//////////////////////////////////////////////////////////////////////

Task("Restore-NuGet-Packages")
    .Does(() =>
{
	NuGetRestore("./VSPreCommitChecks.sln");
});

Task("PatchVersion")
    .IsDependentOn("Restore-NuGet-Packages")
    .Does(() =>
{
    Information("Version: " + version);


	ReplaceTextInFiles("./src/Properties/AssemblyInfo.cs",
                        "9.9.9.9",
                        version);

	ReplaceTextInFiles("./src/source.extension.vsixmanifest",
						"9.9.9.9",
						version);
});

Task("Build")
    .IsDependentOn("PatchVersion")
    .Does(() =>
{
    Information("Building version: " + version);
    
    MSBuild("./VSPreCommitChecks.sln", settings => {
		settings.SetConfiguration(configuration);
        settings.SetPlatformTarget(PlatformTarget.x86);
	});
});

//////////////////////////////////////////////////////////////////////
// TASK TARGETS
//////////////////////////////////////////////////////////////////////

Task("Default")
    .IsDependentOn("Build");

//////////////////////////////////////////////////////////////////////
// EXECUTION
//////////////////////////////////////////////////////////////////////

RunTarget(target);